!function(e){const t=e(document);let n=!1;const s=function(t){t.preventDefault();const s=e(this);n||confirm(lpGlobalSettings.i18n.confirm_install_sample_data)&&(s.addClass("disabled").html(s.data("installing-text")),e(".lp-install-sample__response").remove(),n=!0,e.ajax({url:s.attr("href"),data:e(".lp-install-sample__options").serializeJSON(),success(t){s.removeClass("disabled").html(s.data("text")),n=!1,e(t).insertBefore(s.parent())},error(){s.removeClass("disabled").html(s.data("text")),n=!1,e(response).insertBefore(s.parent())}}))},l=function(t){t.preventDefault();const s=e(this);n||confirm(lpGlobalSettings.i18n.confirm_uninstall_sample_data)&&(s.addClass("disabled").html(s.data("uninstalling-text")),n=!0,e.ajax({url:s.attr("href"),success(t){s.removeClass("disabled").html(s.data("text")),n=!1,e(t).insertBefore(s.parent())},error(){s.removeClass("disabled").html(s.data("text")),n=!1,e(response).insertBefore(s.parent())}}))},a=function(t){t.preventDefault();const n=e(this);n.hasClass("disabled")||(n.addClass("disabled").html(n.data("cleaning-text")),e.ajax({url:n.attr("href"),data:{},success(e){n.removeClass("disabled").html(n.data("text"))},error(){n.removeClass("disabled").html(n.data("text"))}}))},o=function(){e.ajax({url:"admin.php?page=lp-toggle-hard-cache-option",data:{v:this.checked?"yes":"no"},success(e){},error(){}})},i=function(t){t.preventDefault(),e(".lp-install-sample__options").toggleClass("hide-if-js")};let r;const d={elMainContent:null,elTitle:null,elBtnYes:null,elBtnNo:null,elFooter:null,elCalledModal:null,callBackYes:null,init(){const t=this;this.elMainContent=r.find(".main-content"),this.elTitle=r.find(".modal-title"),this.elBtnYes=r.find(".btn-yes"),this.elBtnNo=r.find(".btn-no"),this.elFooter=r.find(".lp-modal-footer"),e(document).on("click",".close, .btn-no",(function(){r.hide()})),e(document).on("click",".btn-yes",(function(){t.callBackYes()}))},setElCalledModal(e){this.elCalledModal=e},setContentModal(e,t){this.elMainContent.html(e),"function"==typeof t&&t()},setTitleModal(e){this.elTitle.html(e)}},p=function(){let t=0;r.show();const n=e("#lp-tool-upgrade-db"),s=n.find(".wrapper-terms-upgrade"),l=n.find(".wrapper-lp-status-upgrade"),a=n.find(".wrapper-lp-upgrade-message");if(!n.length)return;let o=null;if(s.length){d.setContentModal(s.html());const t=r.find(".terms-upgrade"),n=t.find("input[name=lp-agree-term]"),a=t.find(".error"),i=e("input[name=message-when-upgrading]").val();o=function(){return a.hide(),a.removeClass("learn-press-message"),n.is(":checked")?(c("/lp/v1/database/agree_terms",{agree_terms:1},{}),d.elFooter.find(".learn-press-notice").remove(),d.elFooter.prepend('<span class="learn-press-notice">'+i+"</span>"),d.setContentModal(l.html()),!0):(a.show(),a.addClass("learn-press-message"),d.elMainContent.animate({scrollTop:a.offset().top}),!1)}}else d.setContentModal(l.html()),o=function(){return!0};d.setTitleModal(n.find("h2").html()),d.elBtnYes.text("Upgrade"),d.elBtnYes.show(),d.elBtnNo.text("close"),d.callBackYes=function(){if(!o())return;t=1,d.elBtnYes.hide(),d.elBtnNo.hide();const n=r.find(".lp-group-step"),s=r.find(".lp-item-step"),l=[];e.each(s,(function(t,n){const s=e(n);if(!s.hasClass("completed")){const e=s.find("input").val();l.push(e)}}));const i={steps:l,step:l[0]},p=(e,t)=>{elItemStepCurrent=n.find("input[value="+e+"]").closest(".lp-item-step"),elItemStepCurrent.addClass("running"),100===t&&elItemStepCurrent.removeClass("running").addClass("completed"),elItemStepCurrent.find(".progress-bar").css("width",t+"%"),elItemStepCurrent.find(".percent").text(t+"%")};p(l[0],.1);const u={success:e=>{p(i.step,e.percent),i.step!==e.name&&p(e.name,.1),"success"===e.status?((e=>{elItemStepCurrent=n.find("input[value="+e+"]").closest(".lp-item-step");const t=elItemStepCurrent.offset().top-d.elMainContent.offset().top+d.elMainContent.scrollTop();d.elMainContent.stop().animate({scrollTop:t},600)})(i.step),i.step=e.name,i.data=e.data,setTimeout(()=>{c("/lp/v1/database/upgrade",i,u)},800)):"finished"===e.status?(t=0,elItemStepCurrent.removeClass("running").addClass("completed"),setTimeout(()=>{d.setContentModal(a.html())},1e3),d.elFooter.find(".learn-press-notice").remove(),d.elBtnNo.show(),d.elBtnNo.on("click",()=>{window.location.reload()})):(t=0,d.elFooter.find(".learn-press-notice").remove(),elItemStepCurrent.removeClass("running").addClass("error"),d.elBtnYes.text("Retry").show(),d.setContentModal(a.html(),(function(){d.elMainContent.find(".learn-press-message").addClass("error").html(e.message)})))},error:e=>{t=0,d.setContentModal(a.html(),(function(){d.elBtnYes.text("Retry").show(),d.elBtnNo.show(),d.elMainContent.find(".learn-press-message").addClass("error").html(e.message)}))},completed:()=>{}};c("/lp/v1/database/upgrade",i,u)},window.onbeforeunload=function(){if(t)return"LP is upgrading Database. Are you want to reload page?"},window.onclose=function(){if(t)return"LP is upgrading Database. Are you want to close page?"}},c=function(e,t,n){wp.apiFetch({path:e,method:"POST",data:t}).then(e=>{"function"==typeof n.success&&n.success(e)}).catch(e=>{"function"==typeof n.error&&n.error(e)}).then(()=>{"function"==typeof n.completed&&n.completed()})};e((function(){r=e(".lp-overlay"),function(){const t=e(".wrapper-lp-status-upgrade");c("/lp/v1/database/get_steps",{},{success:n=>{const{steps_completed:s,steps_default:l}=n;if(void 0===s||void 0===l)return console.log("invalid steps_completed and steps_default"),!1;let a="";for(const n in l){const o=l[n],i=o.steps;a='<div class="lp-group-step">',a+="<h3>"+o.label+"</h3>";for(const e in i){const t=i[e];let n="";void 0!==s[e]&&(n="completed"),a+='<div class="lp-item-step '+n+'">',a+='<div class="lp-item-step-left"><input type="hidden" name="lp_steps_upgrade_db[]" value="'+t.name+'"  /></div>',a+='<div class="lp-item-step-right">',a+='<label for=""><strong></strong>'+t.label+"</label>",a+='<div class="description">'+t.description+"</div>",a+='<div class="percent"></div>',a+='<span class="progress-bar"></span>',a+="</div>",a+="</div>"}a+="</div>",t.append(a);const r=window.location.search,c=new URLSearchParams(r).get("action"),u=e(".lp-btn-upgrade-db");d.init(),u.on("click",(function(){p()})),"upgrade-db"===c&&p()}},error:e=>{},completed:()=>{}})}(),t.on("click",".lp-install-sample__install",s).on("click",".lp-install-sample__uninstall",l).on("click","#learn-press-clear-cache",a).on("click",'input[name="enable_hard_cache"]',o).on("click",".lp-install-sample__toggle-options",i)}))}(jQuery);
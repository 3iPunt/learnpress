!function(e){const t=e(document);let s=!1;const l=function(t){t.preventDefault();const l=e(this);s||confirm(lpGlobalSettings.i18n.confirm_install_sample_data)&&(l.addClass("disabled").html(l.data("installing-text")),e(".lp-install-sample__response").remove(),s=!0,e.ajax({url:l.attr("href"),data:e(".lp-install-sample__options").serializeJSON(),success(t){l.removeClass("disabled").html(l.data("text")),s=!1,e(t).insertBefore(l.parent())},error(){l.removeClass("disabled").html(l.data("text")),s=!1,e(response).insertBefore(l.parent())}}))},n=function(t){t.preventDefault();const l=e(this);s||confirm(lpGlobalSettings.i18n.confirm_uninstall_sample_data)&&(l.addClass("disabled").html(l.data("uninstalling-text")),s=!0,e.ajax({url:l.attr("href"),success(t){l.removeClass("disabled").html(l.data("text")),s=!1,e(t).insertBefore(l.parent())},error(){l.removeClass("disabled").html(l.data("text")),s=!1,e(response).insertBefore(l.parent())}}))},a=function(t){t.preventDefault();const s=e(this);s.hasClass("disabled")||(s.addClass("disabled").html(s.data("cleaning-text")),e.ajax({url:s.attr("href"),data:{},success(e){s.removeClass("disabled").html(s.data("text"))},error(){s.removeClass("disabled").html(s.data("text"))}}))},o=function(){e.ajax({url:"admin.php?page=lp-toggle-hard-cache-option",data:{v:this.checked?"yes":"no"},success(e){},error(){}})},i=function(t){t.preventDefault(),e(".lp-install-sample__options").toggleClass("hide-if-js")};let r;const d={elMainContent:null,elTitle:null,elBtnYes:null,elBtnNo:null,elFooter:null,elCalledModal:null,callBackYes:null,init(){const t=this;this.elMainContent=r.find(".main-content"),this.elTitle=r.find(".modal-title"),this.elBtnYes=r.find(".btn-yes"),this.elBtnNo=r.find(".btn-no"),this.elFooter=r.find(".lp-modal-footer"),e(document).on("click",".close, .btn-no",(function(){r.hide()})),e(document).on("click",".btn-yes",(function(){t.callBackYes()}))},setElCalledModal(e){this.elCalledModal=e},setContentModal(e,t){this.elMainContent.html(e),"function"==typeof t&&t()},setTitleModal(e){this.elTitle.html(e)}},p=function(){r.show();const t=e("#lp-tool-upgrade-db"),s=t.find(".wrapper-terms-upgrade"),l=t.find(".wrapper-lp-status-upgrade"),n=t.find(".wrapper-lp-upgrade-message");if(!t.length)return;let a=null;if(s.length){d.setContentModal(s.html());const t=r.find(".terms-upgrade"),n=t.find("input[name=lp-agree-term]"),o=t.find(".error"),i=e("input[name=message-when-upgrading]").val();a=function(){return o.hide(),o.removeClass("learn-press-message"),n.is(":checked")?(d.elFooter.prepend('<span class="learn-press-notice">'+i+"</span>"),d.setContentModal(l.html()),!0):(o.show(),o.addClass("learn-press-message"),d.elMainContent.animate({scrollTop:o.offset().top}),!1)}}else d.setContentModal(l.html()),a=function(){return!0};d.setTitleModal(t.find("h2").html()),d.elBtnYes.text("Upgrade"),d.elBtnYes.show(),d.elBtnNo.text("close"),d.callBackYes=function(){if(!a())return;d.elBtnYes.attr("disabled","disabled"),d.elBtnNo.attr("disabled","disabled");const t=r.find(".lp-group-step"),s=r.find(".lp-item-step"),l=[];e.each(s,(function(t,s){const n=e(s);if(!n.hasClass("completed")){const e=n.find("input").val();l.push(e)}}));const o={steps:l,step:l[0]},i=(e,s)=>{elItemStepCurrent=t.find("input[value="+e+"]").closest(".lp-item-step"),elItemStepCurrent.addClass("running"),100===s&&elItemStepCurrent.removeClass("running").addClass("completed"),elItemStepCurrent.find(".progress-bar").css("width",s+"%"),elItemStepCurrent.find(".percent").text(s+"%")};s.find("input").attr("disabled","disabled"),i(l[0],.1);const p={success:e=>{i(o.step,e.percent),o.step!==e.name&&i(e.name,.1),"success"===e.status?((e=>{elItemStepCurrent=t.find("input[value="+e+"]").closest(".lp-item-step");const s=elItemStepCurrent.offset().top-d.elMainContent.offset().top+d.elMainContent.scrollTop();d.elMainContent.stop().animate({scrollTop:s},600)})(o.step),o.step=e.name,o.data=e.data,setTimeout(()=>{c("/lp/v1/database/upgrade",o,p)},800)):"finished"===e.status?(elItemStepCurrent.removeClass("running").addClass("completed"),setTimeout(()=>{d.setContentModal(n.html())},1e3),d.elFooter.find(".learn-press-notice").remove(),d.elBtnYes.removeAttr("disabled").hide(),d.elBtnNo.removeAttr("disabled"),d.elBtnNo.on("click",()=>{window.location.reload()})):(elItemStepCurrent.removeClass("running").addClass("error"),d.setContentModal(n.html(),(function(){d.elMainContent.find(".learn-press-message").addClass("error").html(e.message)})))},error:e=>{d.setContentModal(n.html(),(function(){d.elBtnYes.removeAttr("disabled").hide(),d.elBtnNo.removeAttr("disabled"),d.elMainContent.find(".learn-press-message").addClass("error").html(e.message)}))},completed:()=>{}};c("/lp/v1/database/upgrade",o,p)},e(".lp-overlay").css("display","block")},c=function(e,t,s){wp.apiFetch({path:e,method:"POST",data:t}).then(e=>{"function"==typeof s.success&&s.success(e)}).catch(e=>{"function"==typeof s.error&&s.error(e)}).then(()=>{"function"==typeof s.completed&&s.completed()})};e((function(){r=e(".lp-overlay"),function(){const t=e(".wrapper-lp-status-upgrade");c("/lp/v1/database/get_steps",{},{success:s=>{const{steps_completed:l,steps_default:n}=s;if(void 0===l||void 0===n)return console.log("invalid steps_completed and steps_default"),!1;let a="";for(const s in n){const o=n[s],i=o.steps;a='<div class="lp-group-step">',a+="<h3>"+o.label+"</h3>";for(const e in i){const t=i[e];let s="";void 0!==l[e]&&(s="completed"),a+='<div class="lp-item-step '+s+'">',a+='<div class="lp-item-step-left"><input type="hidden" name="lp_steps_upgrade_db[]" value="'+t.name+'"  /></div>',a+='<div class="lp-item-step-right">',a+='<label for=""><strong></strong>'+t.label+"</label>",a+='<div class="description">'+t.description+"</div>",a+='<div class="percent"></div>',a+='<span class="progress-bar"></span>',a+="</div>",a+="</div>"}a+="</div>",t.append(a);const r=window.location.search,c=new URLSearchParams(r).get("action"),u=e(".lp-btn-upgrade-db");d.init(),u.on("click",(function(){p()})),"upgrade-db"===c&&p()}},error:e=>{},completed:()=>{}})}(),t.on("click",".lp-install-sample__install",l).on("click",".lp-install-sample__uninstall",n).on("click","#learn-press-clear-cache",a).on("click",'input[name="enable_hard_cache"]',o).on("click",".lp-install-sample__toggle-options",i)}))}(jQuery);
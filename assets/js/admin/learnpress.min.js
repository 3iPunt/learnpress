var $=jQuery,$doc=$(document),$win=$(window),makePaymentsSortable=function(){$(".learn-press-payments.sortable tbody").sortable({handle:".dashicons-menu",helper:function(e,a){return a.children().each(function(){$(this).width($(this).width())}),a},axis:"y",start:function(e,a){},stop:function(e,a){},update:function(e,a){var t=$(this).children().map(function(){return $(this).find('input[name="payment-order"]').val()}).get();$.post({url:"",data:{"lp-ajax":"update-payment-order",order:t},success:function(e){}})}})},initTooltips=function(){$(".learn-press-tooltip").each(function(){var e=$(this),a=$.extend({title:"data-tooltip",offset:10,gravity:"s"},e.data());e.tipsy(a)})},initSelect2=function(){$.fn.select2&&$(".lp-select-2 select").select2()},initSingleCoursePermalink=function(){$doc.on("change",'.learn-press-single-course-permalink input[type="radio"]',function(){var e=$(this).closest(".learn-press-single-course-permalink");e.hasClass("custom-base")?e.find('input[type="text"]').prop("readonly",!1):e.siblings(".custom-base").find('input[type="text"]').prop("readonly",!0)}).on("change","input.learn-press-course-base",function(){$("#course_permalink_structure").val($(this).val())}).on("focus","#course_permalink_structure",function(){$("#learn_press_custom_permalink").click()}).on("change","#learn_press_courses_page_id",function(){$("tr.learn-press-courses-page-id").toggleClass("hide-if-js",!parseInt(this.value))})},togglePaymentStatus=function(e){e.preventDefault();var a=$(this).closest("tr"),t=($(this),a.find(".status").hasClass("enabled")?"no":"yes");$.ajax({url:"",data:{"lp-ajax":"update-payment-status",status:t,id:a.data("payment")},success:function(e){for(var a in e=LP.parseJSON(e))$("#payment-"+a+" .status").toggleClass("enabled",e[a])}})},updateEmailStatus=function(){(function(){$.post({url:window.location.href,data:{"lp-ajax":"update_email_status",status:$(this).parent().hasClass("enabled")?"no":"yes",id:$(this).data("id")},dataType:"text",success:$.proxy(function(e){for(var a in e=LP.parseJSON(e))$("#email-"+a+" .status").toggleClass("enabled",e[a])},this)})}).apply(this)},toggleSalePriceSchedule=function(){return"_lp_sale_price_schedule"===$(this).attr("id")?($(this).hide(),$("#field-_lp_sale_start, #field-_lp_sale_end").removeClass("hide-if-js"),$win.trigger("resize.calculate-tab")):($("#_lp_sale_price_schedule").show(),$("#field-_lp_sale_start, #field-_lp_sale_end").addClass("hide-if-js").find("#_lp_sale_start, #_lp_sale_end").val(""),$win.trigger("resize.calculate-tab")),!1},callbackFilterTemplates=function(){var e=$(this);if(e.hasClass("current"))return!1;var a=$("#learn-press-template-files"),t=a.find("tr[data-template]"),s=e.data("template"),i=e.data("filter");return e.addClass("current").siblings("a").removeClass("current"),s?t.map(function(){$(this).toggleClass("hide-if-js",$(this).data("template")!==s)}):i?t.map(function(){$(this).toggleClass("hide-if-js","yes"!==$(this).data("filter-"+i))}):t.removeClass("hide-if-js"),$("#learn-press-no-templates").toggleClass("hide-if-js",!!a.find("tr.template-row:not(.hide-if-js):first").length),!1},toggleEmails=function(e){e.preventDefault();var a=$(this).data("status");$.ajax({url:"",data:{"lp-ajax":"update_email_status",status:a},success:function(e){for(var a in e=LP.parseJSON(e))$("#email-"+a+" .status").toggleClass("enabled",e[a])}})},duplicatePost=function(e){e.preventDefault();var a=$(this).data("post-id");$.ajax({url:"",data:{"lp-ajax":"duplicator",id:a},success:function(e){(e=LP.parseJSON(e)).success?window.location.href=e.data:alert(e.data)}})},importCourses=function(){var a=$("#learn-press-install-sample-data-notice"),t=$(this).attr("data-action");t&&(e.preventDefault(),"yes"===t?a.find(".install-sample-data-notice").slideUp().siblings(".install-sample-data-loading").slideDown():a.fadeOut(),$.ajax({url:ajaxurl,dataType:"html",type:"post",data:{action:"learnpress_install_sample_data",yes:t},success:function(e){(e=LP.parseJSON(e)).url?$.ajax({url:e.url,success:function(){a.find(".install-sample-data-notice").html(e.message).slideDown().siblings(".install-sample-data-loading").slideUp()}}):a.find(".install-sample-data-notice").html(e.message).slideDown().siblings(".install-sample-data-loading").slideUp()}}))},onChangeCoursePrices=function(e){var a=$(this),t=$("#_lp_price"),s=$("#_lp_sale_price"),i=$(e.target).attr("id");a.find("#field-_lp_price div, #field-_lp_sale_price div").remove(".learn-press-tip-floating"),parseInt(s.val())>=parseInt(t.val())&&("_lp_price"===i?t.parent(".rwmb-input").append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_price+"</div>"):"_lp_sale_price"===i&&s.parent(".rwmb-input").append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_sale_price+"</div>"))},onChangeSaleStartDate=function(e){var a=$(this),t=$("#_lp_sale_end"),s=Date.parse(a.val()),i=Date.parse(t.val()),n=a.parent(".rwmb-input");t.parent(".rwmb-input");s||n.append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_invalid_date+"</div>"),$("#field-_lp_sale_start div, #field-_lp_sale_end div").remove(".learn-press-tip-floating"),s>i&&n.append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_sale_start_date+"</div>")},onChangeSaleEndDate=function(e){var a=$(this),t=$("#_lp_sale_start"),s=Date.parse(t.val()),i=Date.parse(a.val()),n=(t.parent(".rwmb-input"),a.parent(".rwmb-input"));i||n.append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_invalid_date+"</div>"),$("#field-_lp_sale_start div, #field-_lp_sale_end div").remove(".learn-press-tip-floating"),s>i&&n.append('<div class="learn-press-tip-floating">'+lpAdminCourseEditorSettings.i18n.notice_sale_end_date+"</div>")},onReady=function(){makePaymentsSortable(),initSelect2(),initTooltips(),initSingleCoursePermalink(),$(".learn-press-tabs").LP("AdminTab"),$(document).on("click",".learn-press-payments .status .dashicons",togglePaymentStatus).on("click",".change-email-status",updateEmailStatus).on("click","#_lp_sale_price_schedule",toggleSalePriceSchedule).on("click","#_lp_sale_price_schedule_cancel",toggleSalePriceSchedule).on("click",".learn-press-filter-template",callbackFilterTemplates).on("click","#learn-press-enable-emails, #learn-press-disable-emails",toggleEmails).on("click",".lp-duplicate-row-action .lp-duplicate-post",duplicatePost).on("click","#learn-press-install-sample-data-notice a",importCourses).on("input","#meta-box-tab-course_payment",onChangeCoursePrices).on("change","#_lp_sale_start",onChangeSaleStartDate).on("change","#_lp_sale_end",onChangeSaleEndDate)};$(document).ready(onReady);